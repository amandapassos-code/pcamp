<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Retorno - relevanC (Modelo Calibrado)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Anima√ß√£o de Flash para o Resultado */
        @keyframes flash-red {
            0% { background-color: rgba(254, 75, 75, 0.2); }
            100% { background-color: transparent; }
        }
        .animate-flash {
            animation: flash-red 1s ease-out;
        }

        /* Cor personalizada da marca */
        .text-brand { color: #FE4B4B; }
        .bg-brand { background-color: #FE4B4B; }
        .border-brand { border-color: #FE4B4B; }
        .accent-brand { accent-color: #FE4B4B; }
        .hover-bg-brand:hover { background-color: #d63030; }
        
        /* Remove setas do input number */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            // --- ESTADOS ---
            const [mode, setMode] = useState('calc_investment'); 
            
            // Valores iniciais baseados na mediana dos seus dados
            const [audience, setAudience] = useState(150000);
            const [duration, setDuration] = useState(30);
            const [investment, setInvestment] = useState(5000);
            const [roas, setRoas] = useState(6.0); // M√©dia saud√°vel observada no CSV

            const [flash, setFlash] = useState(false);

            // --- L√ìGICA DE C√ÅLCULO (REGRESS√ÉO BASEADA NO CSV) ---
            
            // Fun√ß√£o auxiliar para disparar anima√ß√£o visual
            const triggerFlash = () => {
                setFlash(true);
                setTimeout(() => setFlash(false), 1000);
            };

            const calculate = (triggerSource, newVal) => {
                let currentAudience = audience;
                let currentDuration = duration;
                let currentRoas = roas;
                let currentInvestment = investment;

                // Atualiza o estado local temporariamente para o c√°lculo
                if (triggerSource === 'audience') { setAudience(newVal); currentAudience = newVal; }
                if (triggerSource === 'duration') { setDuration(newVal); currentDuration = newVal; }
                if (triggerSource === 'roas') { setRoas(newVal); currentRoas = newVal; }
                if (triggerSource === 'investment') { setInvestment(newVal); currentInvestment = newVal; }

                // --- MODELO ESTAT√çSTICO (Derivado do CSV 'campaign planner 12052025.csv') ---
                
                // 1. Custo Basal de M√≠dia (Base Cost)
                // An√°lise: Campanhas pequenas pagam mais caro por shopper (R$ 0.05+). Campanhas grandes (>500k) pagam menos (R$ 0.02-0.03).
                // Dura√ß√£o adiciona custo fixo operacional.
                const costPerShopper = currentAudience > 500000 ? 0.028 : 0.045; // Efici√™ncia de escala
                const dailyOverhead = 150; // Custo m√©dio di√°rio (overhead de manter campanha ativa)
                
                // Custo "Natural" para atingir essa audi√™ncia nesse tempo
                const naturalMediaCost = (currentAudience * costPerShopper) + (currentDuration * dailyOverhead);

                // 2. Potencial de Receita (Revenue Potential)
                // An√°lise: A receita escala com a audi√™ncia, mas tem retornos decrescentes.
                // Usamos um fator base de convers√£o extra√≠do das campanhas de alta performance (ex: RBR-613, RBR-1382).
                const revenueFactor = 0.25; // R$ 0,25 de retorno m√©dio "org√¢nico" por shopper impactado em boas condi√ß√µes
                const expectedRevenue = (currentAudience * revenueFactor) * (1 + (currentDuration / 100)); // Campanhas mais longas convertem um pouco mais

                
                if (mode === 'calc_investment') {
                    // MODO 1: Usu√°rio quer saber QUANTO INVESTIR para ter X ROAS
                    if (triggerSource !== 'investment') {
                        // F√≥rmula: Investimento = Receita Esperada / ROAS Desejado
                        // Mas aplicamos um "piso" (Floor) que √© o Custo Natural de M√≠dia. 
                        // N√£o d√° pra ter ROAS infinito investindo zero.
                        
                        let targetInv = expectedRevenue / Math.max(0.1, currentRoas);
                        
                        // Ajuste fino: Se o ROAS pedido for muito baixo, o sistema sugere investir mais (perto do teto natural)
                        // Se o ROAS pedido for muito alto, o sistema sugere investir menos (sniper targeting), mas nunca abaixo do piso t√©cnico.
                        
                        // Piso T√©cnico: R$ 0.01 por user (m√≠nimo absoluto do mercado)
                        const technicalFloor = currentAudience * 0.01; 
                        
                        // Se o c√°lculo matem√°tico jogar o investimento abaixo do poss√≠vel, travamos no piso.
                        targetInv = Math.max(targetInv, technicalFloor);
                        
                        setInvestment(Math.round(targetInv));
                        triggerFlash();
                    }
                } else {
                    // MODO 2: Usu√°rio tem OR√áAMENTO FIXO e quer saber o ROAS
                    if (triggerSource !== 'roas') {
                        // F√≥rmula: ROAS = Receita Potencial / Investimento Dispon√≠vel
                        // O investimento impacta a receita? Sim. Se investir pouco, n√£o atinge toda a base.
                        
                        // Fator de Satura√ß√£o: Se investir muito mais que o necess√°rio, o ROAS cai (retornos decrescentes).
                        const saturationPoint = naturalMediaCost * 1.5; 
                        let effectiveRevenue = expectedRevenue;

                        if (currentInvestment < naturalMediaCost * 0.5) {
                            // Investimento muito baixo penaliza a receita (n√£o atinge frequ√™ncia m√≠nima)
                            effectiveRevenue = expectedRevenue * (currentInvestment / (naturalMediaCost * 0.5));
                        }
                        
                        let calcRoas = effectiveRevenue / Math.max(100, currentInvestment);
                        
                        // Travas de seguran√ßa baseadas no hist√≥rico (Max ROAS no CSV foi ~34x, Min ~0.05x)
                        calcRoas = Math.min(35, Math.max(0.05, calcRoas));
                        
                        setRoas(parseFloat(calcRoas.toFixed(2)));
                        triggerFlash();
                    }
                }
            };

            // Efeito colateral: Recalcular quando muda o modo
            useEffect(() => {
                triggerFlash();
                if (mode === 'calc_investment') {
                    calculate('roas', roas); 
                } else {
                    calculate('investment', investment);
                }
            }, [mode]);

            // Utilit√°rio de formata√ß√£o
            const formatNumber = (num) => new Intl.NumberFormat('pt-BR').format(num);

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 md:p-8 font-sans bg-gray-50">
                    
                    <div className="w-full max-w-5xl bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100">
                        
                        {/* HEADER */}
                        <div className="bg-white px-6 py-6 flex flex-col md:flex-row gap-6 justify-between items-center border-b border-gray-100">
                            
                            {/* Logo & T√≠tulo */}
                            <div className="flex items-center gap-4">
                                <img 
                                    src="./Logo-Master-relevanC-@4x (1).png" 
                                    alt="Logo relevanC" 
                                    className="h-8 md:h-10 object-contain"
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                        document.getElementById('logo-fallback').style.display = 'block';
                                    }}
                                />
                                <span id="logo-fallback" className="hidden text-2xl font-bold text-gray-800 tracking-tighter">
                                    relevan<span className="text-brand underline">C</span>
                                </span>
                                
                                <div className="h-6 w-px bg-gray-200 hidden md:block"></div>
                                
                                <h1 className="text-base md:text-lg font-bold uppercase tracking-wide text-gray-500">
                                    Planejador de Campanha
                                </h1>
                            </div>
                            
                            {/* Toggle de Modos */}
                            <div className="flex bg-gray-100 rounded-full p-1.5 shadow-inner">
                                <button 
                                    onClick={() => setMode('calc_investment')}
                                    className={`px-5 py-2 rounded-full text-xs md:text-sm font-bold transition-all duration-300 ${
                                        mode === 'calc_investment' 
                                        ? 'bg-brand text-white shadow-md transform scale-105' 
                                        : 'text-gray-400 hover:text-gray-600'
                                    }`}
                                >
                                    Descobrir Investimento
                                </button>
                                <button 
                                    onClick={() => setMode('calc_roas')}
                                    className={`px-5 py-2 rounded-full text-xs md:text-sm font-bold transition-all duration-300 ${
                                        mode === 'calc_roas' 
                                        ? 'bg-brand text-white shadow-md transform scale-105' 
                                        : 'text-gray-400 hover:text-gray-600'
                                    }`}
                                >
                                    Tenho Or√ßamento Fixo
                                </button>
                            </div>
                        </div>

                        <div className="p-8 md:p-14">
                            
                            {/* SE√á√ÉO PRINCIPAL: AUDI√äNCIA */}
                            <div className="mb-20 flex flex-col items-center animate-fade-in">
                                <label className="block text-lg font-bold mb-4 text-gray-700">
                                    Tamanho da Base
                                </label>
                                <div className="relative group transition-all duration-300 transform hover:scale-105">
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        value={audience > 0 ? formatNumber(audience) : ''}
                                        placeholder="0"
                                        onChange={(e) => {
                                            const rawValue = e.target.value.replace(/\D/g, '');
                                            const numericValue = rawValue ? parseInt(rawValue, 10) : 0;
                                            calculate('audience', numericValue);
                                        }}
                                        className="w-80 h-24 bg-gray-50 rounded-2xl text-center text-4xl font-bold text-gray-800 border-2 border-gray-200 focus:border-brand focus:outline-none focus:ring-4 focus:ring-red-100 transition-all shadow-sm"
                                    />
                                    <div className="absolute -bottom-10 left-0 right-0 text-center text-brand font-bold text-sm tracking-widest uppercase opacity-80">
                                        Shoppers na Audi√™ncia
                                    </div>
                                    <div className="absolute top-1/2 -translate-y-1/2 right-6 text-gray-300 pointer-events-none text-2xl">
                                        üë•
                                    </div>
                                </div>
                            </div>

                            <div className="border-t border-gray-100 mb-16"></div>

                            {/* GRID DE SLIDERS */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 lg:gap-12 items-start">
                                
                                {/* 1. DURA√á√ÉO */}
                                <ControlGroup 
                                    label="Dura√ß√£o da Campanha"
                                    suffix="dias"
                                    value={duration}
                                    min={1}
                                    max={90}
                                    step={1}
                                    onChange={(v) => calculate('duration', v)}
                                    isOutput={false}
                                />

                                {/* 2. INVESTIMENTO */}
                                <ControlGroup 
                                    label="Investimento Total"
                                    prefix="R$"
                                    value={investment}
                                    min={100}
                                    max={500000} 
                                    step={100}
                                    onChange={(v) => calculate('investment', v)}
                                    isOutput={mode === 'calc_investment'}
                                    flash={mode === 'calc_investment' && flash}
                                    useThousands={true}
                                />

                                {/* 3. ROAS */}
                                <ControlGroup 
                                    label="ROAS Esperado"
                                    suffix="x"
                                    value={roas}
                                    min={0.1}
                                    max={35.0}
                                    step={0.1}
                                    onChange={(v) => calculate('roas', v)}
                                    isOutput={mode === 'calc_roas'}
                                    flash={mode === 'calc_roas' && flash}
                                />

                            </div>
                        </div>
                        
                        {/* FOOTER */}
                        <div className="bg-gray-50 p-4 border-t border-gray-100 text-center flex flex-col gap-1 justify-center items-center">
                             <span className="text-gray-400 text-xs">&copy; 2025 relevanC. Todos os direitos reservados.</span>
                             <span className="text-gray-300 text-[10px]">Modelo v3.0 ‚Ä¢ Calibrado com dados hist√≥ricos 2023-2025</span>
                        </div>
                    </div>
                </div>
            );
        };

        // --- COMPONENTE REUTILIZ√ÅVEL ---
        const ControlGroup = ({ label, value, min, max, step, onChange, isOutput, prefix, suffix, flash, useThousands }) => {
            const handleChange = (e) => {
                if (isOutput) return; 
                onChange(Number(e.target.value));
            };
            const handleTextChange = (e) => {
                 if (isOutput) return;
                 let val = e.target.value;
                 if (useThousands) val = val.replace(/\D/g, '');
                 onChange(Number(val));
            };

            return (
                <div className={`flex flex-col gap-5 p-6 rounded-2xl transition-all duration-500 ${flash ? 'animate-flash bg-red-50' : 'bg-white'} ${isOutput ? 'bg-gray-50 border-2 border-dashed border-gray-200' : 'bg-white border border-gray-100 shadow-lg'}`}>
                    
                    <div className="flex justify-between items-end h-6">
                        <label className={`font-bold text-sm uppercase tracking-wide ${isOutput ? 'text-gray-400' : 'text-gray-700'}`}>
                            {label}
                        </label>
                        {isOutput && (
                            <span className="text-[10px] font-bold text-white bg-brand px-2 py-0.5 rounded uppercase shadow-sm">
                                Estimado
                            </span>
                        )}
                    </div>

                    {/* Slider Area */}
                    <div className="relative w-full h-8 flex items-center group">
                        <input
                            type="range"
                            min={min}
                            max={max}
                            step={step}
                            value={value}
                            onChange={handleChange}
                            disabled={isOutput}
                            className={`absolute w-full h-full opacity-0 z-20 ${isOutput ? 'cursor-not-allowed' : 'cursor-pointer'}`}
                        />
                        
                        {/* Track */}
                        <div className="absolute w-full h-3 bg-gray-100 rounded-full overflow-hidden z-0 border border-gray-200">
                            <div 
                                className={`h-full transition-all duration-300 ease-out ${isOutput ? 'bg-gray-400' : 'bg-brand'}`} 
                                style={{ width: `${Math.min(100, ((value - min) / (max - min)) * 100)}%`, opacity: isOutput ? 0.3 : 1 }}
                            ></div>
                        </div>

                        {/* Thumb (Visual Only) */}
                        <div 
                            className={`absolute h-7 w-7 rounded-full shadow-lg z-10 pointer-events-none transition-all duration-100 flex items-center justify-center border-2 ${isOutput ? 'bg-gray-50 border-gray-300' : 'bg-white border-brand group-hover:scale-110'}`}
                            style={{
                                left: `calc(${Math.min(100, Math.max(0, ((value - min) / (max - min)) * 100))}% - 14px)`
                            }}
                        >
                            {!isOutput && <div className="w-2 h-2 bg-brand rounded-full"></div>}
                        </div>
                    </div>

                    {/* Input Area */}
                    <div className="relative">
                        <div className={`flex items-center justify-center border-b-2 transition-colors pb-2 ${isOutput ? 'border-gray-200' : 'border-gray-200 focus-within:border-brand'}`}>
                            {prefix && <span className={`font-medium mr-2 text-xl ${isOutput ? 'text-gray-400' : 'text-gray-500'}`}>{prefix}</span>}
                            
                            <input
                                type={useThousands ? "text" : "number"}
                                inputMode={useThousands ? "numeric" : undefined}
                                value={useThousands ? (value ? value.toLocaleString('pt-BR') : '') : value}
                                onChange={handleTextChange}
                                disabled={isOutput}
                                className={`w-32 text-center font-bold text-2xl bg-transparent focus:outline-none ${isOutput ? 'text-gray-500' : 'text-gray-800'}`}
                            />
                            
                            {suffix && <span className={`font-medium ml-1 text-sm self-end mb-1.5 ${isOutput ? 'text-gray-400' : 'text-gray-500'}`}>{suffix}</span>}
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
